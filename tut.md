# SQL---Structured Query Language :cyclone:

* __数据库模型__
    * `层次模型`：以“上下级”的层次关系来组织数据的一种方式，层次模型的数据结构看起来就像一颗树；
    * `网状模型`：把每个数据节点和其他很多节点都连接起来，它的数据结构看起来就像很多城市之间的路网；
    * `关系模型`:star:：把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，它的数据模型看起来就是一个Excel表。

* __SQL能力__
    * `DDL`：Data Definition Language  
    DDL允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL由数据库管理员执行。
    * `DML`：Data Manipulation Language  
    DML为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作。
    * `DQL`：Data Query Language  
    DQL允许用户查询数据，这也是通常最频繁的数据库日常操作。
    
* __SQL语言关键字不区分大小写，表名和列名不确定__

## 1. 关系模型

__表的每一行称为`记录（Record）`，记录是一个逻辑意义上的数据。  
表的每一列称为`字段（Column）`，同一个表的每一行记录都拥有相同的若干字段。__    

* 同一个表的所有记录都有相同的字段定义。
* `字段`定义了数据类型（整型、浮点型、字符串、日期等），以及是否允许为`NULL`，`NULL`表示字段数据不存在。   
    一个整型字段如果为`NULL`不表示它的值为`0`；   
    一个字符串型字段为`NULL`也不表示它的值为空串`''`;   
    通常情况下，字段应该避免允许为`NULL`。不允许为`NULL`可以简化查询条件，加快查询速度，也利于应用程序读取数据后无需判断是否为`NULL`。    

### 1.1 主键

__对于关系表，有个很重要的约束，就是任意两条记录不能重复。    
不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一区分出不同的记录，这个字段被称为`主键`。__
* 记录一旦插入到表中，主键最好不要再修改，因为主键是用来唯一定位记录的，修改了主键，会造成一系列的影响。
* 看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。
* 不使用任何业务相关的字段作为主键。一般把这个字段命名为`id`。常见的可作为`id`字段的类型有：
    1. `自增整数类型`：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；   
    `如果使用INT自增类型，当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。`
    2. `全局唯一GUID类型`：使用一种全局唯一的字符串作为主键，类似`8f55d96b-8acc-4636-8cb8-76bf8abc2f57`。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。

__允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为`联合主键`。__  
* 允许列有重复，只要不是所有主键列都重复即可。  
* 尽量不使用联合主键，因为它给关系表带来了复杂度的上升。 

### 1.2 外键

__在表中通过如`class_id`的字段把数据与另一张表关联起来，这种列称为`外键`。__

`class表`
| id | name |	
|--- | --- |
| 1 | 一班 |
| 2 | 二班 |	

`students表`
| id | class_id | name |
|--- | --- | --- |
| 1 | 1 | 小明 |
| 2 | 1 | 小红 |
| 5 | 2 | 小白 |

__定义`外键约束`：__

    ALTER TABLE students
    ADD CONSTRAINT fk_class_id             # 外键约束的名称fk_class_id可以任意
    FOREIGN KEY (class_id)
    REFERENCES classes (id);        
    
__删除`外键约束`：__   

    ALTER TABLE students
    DROP FOREIGN KEY fk_class_id;   

* 通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果`classes`表不存在`id=99`的记录，`students`表就无法插入`class_id=99`的记录。
* 删除外键约束并没有删除外键这一列，删除列是通过`DROP COLUMN ...`实现的。

__“多对多”关系__
* 例如，一个老师可以对应多个班级，一个班级也可以对应多个老师。
* 多对多关系实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系，就形成了多对多关系：

`teachers表`
| id | name |
|--- | --- |
| 1 | 张老师 |
| 2 | 王老师 |
| 3 | 李老师 |

`class表`
| id | name |	
|--- | --- |
| 1 | 一班 |
| 2 | 二班 |	

中间表`teachers_classes`关联两个一对多关系
| id | teacher_id | class_id |
|--- | --- | --- |
| 1 | 1 | 1 |
| 2 | 1 | 2 |
| 3 | 2 | 1 |
| 4 | 2 | 2 |
| 5 | 3 | 1 |

__“一对一”关系__
* 一个表的记录对应到另一个表的唯一一个记录。
* 如果某个学生没有手机号，`contacts表`就不存在对应的记录。实际上，一对一关系准确地说，是`contacts表`一对一对应`students表`。
* 还有一些应用会把一个大表拆成两个一对一的表，目的是把经常读取和不经常读取的字段分开，以获得更高的性能。

`students表`
| id | class_id | name |
|--- | --- | --- |
| 1 | 1 | 小明 |
| 2 | 1 | 小红 |
| 5 | 2 | 小白 |

`contacts表`
| id | student_id | mobile |
|--- | --- | --- |
| 1 | 1 | 135xxxx6919 |
| 2 | 5 | 132xxxx1575 |

### 1.3 索引
__`索引`是关系数据库中对某一列或多个列的值进行预排序的数据结构。__  
通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，大大加快了查询速度。

例如，对于`students表`:
|id|class_id|name|gender|score|
|---|---|---|---|---|
|1|	1|	小明|	M|	90|
|2|	1|	小红|	F|	95|
|3|	1|	小军|	M|	88|

如果要经常根据`score列`进行查询，就可以对`score列`创建索引：

    ALTER TABLE students
    ADD INDEX idx_score (score);    # 索引名称idx_score可以任意
    
索引如果有多列：

    ALTER TABLE students
    ADD INDEX idx_name_score (name, score);

* 可以对一张表创建多个索引。
* 对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。
* 索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。
* 索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，对该列创建索引就没有意义。

__唯一索引__    

身份证号、邮箱地址等字段由于具有业务含义不宜作为主键，但是根据业务要求又具有唯一性约束。因此可以给这些列添加`唯一索引`。

例如，假设`students表`的`name`不能重复：  

    ALTER TABLE students
    ADD UNIQUE INDEX uni_name (name);
    
也可以只对某一列添加一个唯一约束而不创建唯一索引：

    ALTER TABLE students
    ADD CONSTRAINT uni_name UNIQUE (name);

这种情况下，name列没有索引，但仍然具有唯一性保证。

## 2. 查询

`students表`
|id|class_id|	name|	gender|	score|
|---|---|---|---|---|
|1|	1	|小明|	M|	90|
|2|	1	|小红|	F|	95|
|3|	1	|小军|	M|	88|
|4|	1	|小米|	F|	73|
|5|	2	|小白|	F|	81|
|6|	2	|小兵|	M|	55|
|7|	2	|小林|	M|	85|
|8|	3  |小新|	F|	91|
|9|	3	|小王|	M|	89|
|10|	3	|小丽|	F|	85|

`class表`
|id|	name|
|--|--|
|1|	一班|
|2|	二班|
|3|	三班|
|4|	四班|



